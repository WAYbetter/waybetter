{% extends "ride_on_map.html" %}
{% load common_filters %}

{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" href="/static/css/jquery-ui-1.8.14.smoothness.css" type="text/css" media="all">
    <style type="text/css">
        *{
            direction: ltr;
        }
        .clear {
            clear: both;
            height: 0;
            overflow: hidden;
        }
        #map_container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            top: auto;
            width: 100%;
            height: 50%;
        }
        #statistics_container {
            width: 100%;
            height: 50%;
        }
        .statistics_table {
            float: left;
            margin-right: 35px;
            margin-bottom: 25px;
            border: 1px solid;
            padding: 5px;
        }
    </style>
{% endblock %}

{% block content %}
    <div id="statistics_container">
        <h2>Name: {{ computation_set.name }}</h2>

        {% for c in computations %}
            <table class="statistics_table">
                <thead><tr><th colspan="2">id: {{ c.id }} | factor={{ c.toleration_factor }} | minutes={{ c.toleration_factor_minutes }}</th></tr></thead>
                <tr><td># Requests</td><td>{{ c.stat.num_requests }}</td></tr>
                <tr><td># Rides</td><td>{{ c.stat.num_rides }}</td></tr>
                <tr><td># Single rides</td><td>{{ c.stat.num_single_rides }}</td></tr>
                <tr><td>Avg. occupancy</td><td>{{ c.stat.num_requests|divide:c.stat.num_rides|floatformat:"-2" }}</td></tr>
                <tr></tr>
                <tr><td>Avg. single price (meter)</td><td>{{ c.stat.average_single_price|floatformat:"-2" }}</td></tr>
                <tr><td>Avg. shared price (meter)</td><td>{{ c.stat.average_sharing_price|floatformat:"-2" }}</td></tr>
                <tr></tr>
                <tr><td>Avg. time multiplier</td><td>{{ c.stat.average_time_multiplier|floatformat:"-2" }}</td></tr>
                <tr><td>Max time multiplier</td><td>{{ c.stat.max_violation|floatformat:"-2" }}</td></tr>
                <tr><td>Avg. time addition</td><td>{{ c.stat.average_time_addition|floatformat:"-2" }}</td></tr>
                <tr><td>Max time addition</td><td>{{ c.stat.max_violation_time|floatformat:"-2" }}</td></tr>
            </table>
        {% endfor %}
    <div class="clear"></div>
    </div>

    <div id="submit_container">
        Run again >>
        {{ constrains_form.time_const_min.label_tag }}
        {{ constrains_form.time_const_min }}
        {{ constrains_form.time_const_frac.label_tag }}
        {{ constrains_form.time_const_frac }}
        <div id="submit">Go</div>
    </div>

    <div id="map_container">
        <div id="map"></div>
    </div>

{% endblock %}

{% block doc_ready %}
    {{ block.super }}
    <script>
        $("#submit").button().click(function() {
            var toleration_factor_minutes = $("#id_time_const_min").val();
            var toleration_factor_fractional = $("#id_time_const_frac").val();

            if (toleration_factor_minutes && toleration_factor_fractional) {
                alert("Please specify only one time constraint");
                return false;
            }

            $.ajax({
                url: "{% url sharing.passenger_controller.ride_computation_stat %}{{ computation_set.id }}",
                type: "POST",
                data: {"time_const_frac": toleration_factor_fractional, "time_const_min": toleration_factor_minutes},
                success: function(response) {
                    alert(response.content);
                },
                error: function() {
                    alert("There was an error")
                }
            });
        });

    </script>

{% endblock %}