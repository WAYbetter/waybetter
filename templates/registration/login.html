{% extends "base_site.html" %}
{% load i18n %}

{% block extrastyle %}{% load adminmedia %}{{ block.super }}<link rel="stylesheet" type="text/css" href="{% admin_media_prefix %}css/login.css" />{% endblock %}

{% block bodyclass %}login{% endblock %}

{% block content_title %}{% endblock %}

{% block breadcrumbs %}{% endblock %}

{% block content %}
{% if error_message %}
<p class="errornote">{{ error_message }}</p>
{% endif %}
<div id="content-main">
<form action="{{ app_path }}" method="post" id="login-form">{% csrf_token %}
  <div class="form-row">
    <label for="id_username">{% trans 'Username:' %}</label> <input type="text" name="username" id="id_username" />
  </div>
  <div class="form-row">
    <label for="id_password">{% trans 'Password:' %}</label> <input type="password" name="password" id="id_password" />
    <input type="hidden" name="this_is_the_login_form" value="1" />
  </div>
  <div class="submit-row">
    <label>&nbsp;</label><input type="submit" value="{% trans 'Log in' %}" />
  </div>

    <input type="hidden" name="token" id="id_token">

</form>
<p>{% trans "Forgot password" %}? <a href="{% url auth_password_reset %}">{% trans "Reset it" %}</a>!</p>
<p>{% trans "Not member" %}? <a href="{% url registration_register %}">{% trans "Register" %}</a>!</p>
<script type="text/javascript">

    $(function() {
        init();
    });

    function readToken() {
        var token = getToken();
        document.getElementById("id_token").value = token;
        return token;
    }
    
    function init() {
        document.getElementById("id_username").focus();
        token = readToken();
        if (token) {
            var login_form = document.getElementById("login-form");
            login_form.action = "/services/login_workstation/";
            login_form.submit();
        }
    }


     function getToken() {
        try {
            return window.parentSandboxBridge.read_token();
        }
        catch (e) {
//            alert(e);
        }
    }

</script>
</div>
{% endblock %}
