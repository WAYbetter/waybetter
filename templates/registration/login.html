{% extends "wb_base_site.html" %}
{% load i18n %}

{% block content %}
    {% if error_message %}
        <p class="errornote">{{ error_message }}</p>
    {% endif %}
    <div id="content-main">
        <form action="{{ app_path }}" method="post" id="login-form">{% csrf_token %}
            <div class="form-row">
                <label for="id_username">{% trans 'Username:' %}</label> <input type="text" name="username" id="id_username"/>
            </div>
            <div class="form-row">
                <label for="id_password">{% trans 'Password:' %}</label> <input type="password" name="password" id="id_password"/>
                <input type="hidden" name="this_is_the_login_form" value="1"/>
                <input type="hidden" name="next" value="{{ next }}"/>
            </div>
            <div class="submit-row">
                <label>&nbsp;</label><input type="submit" value="{% trans 'Log in' %}"/>
            </div>

            <input type="hidden" name="token" id="id_token">
        </form>
        
        <p>{% trans "Forgot password" %}? <a href="{% url auth_password_reset %}">{% trans "Reset it" %}</a>!</p>

        <p>{% trans "Not member" %}? <a href="{% url registration_register %}">{% trans "Register" %}</a>!</p>
        <script type="text/javascript">

            $(function() {
                init();
            });

            function readToken() {
                var token = air("read_token");
                document.getElementById("id_token").value = token;
                return token;
            }

            function init() {
                document.getElementById("id_username").focus();
                var token = readToken();
                if (token) {
                    var login_form = document.getElementById("login-form");
                    login_form.action = "/services/login_workstation/";
                    login_form.submit();
                }
            }

        </script>
    </div>
{% endblock %}
